from transformers import AutoTokenizer
import os

# 定义模型目录路径
# 你的目录结构是 /data/zdy/Meta-Llama-3-8B-Instruct
model_path = "/data/zdy/Meta-Llama-3-8B-Instruct"

# 检查模型路径是否存在
if not os.path.exists(model_path):
    print(f"Error: Model path '{model_path}' does not exist.")
else:
    try:
        # 加载Llama 3 tokenizer
        # AutoTokenizer.from_pretrained() 会自动检测并加载正确的tokenizer文件
        tokenizer = AutoTokenizer.from_pretrained(model_path)
        print(f"Tokenizer loaded successfully from {model_path}")

        # 你想要计算token数量的文本
        # text = '''Role:\nYou are an expert AI assistant for building management systems. Your task is to analyze the **current (Time T) and previous (T-5min)** real-time status of 7 rooms and determine the likelihood (confidence) that each room's Fan Coil Unit (FCU) Fan Speed setting requires adjustment **for the next 5-minute interval (T to T+5min)**.\n\nGoal:\nAnalyze the **provided current and historical** real-time status of the 7 rooms and output a confidence score for each room regarding the necessity of FCU Fan Speed adjustments **for the next 5-minute interval (T to T+5min)**, based on room temperature and occupancy. **The output should include these confidence scores as a single ordered array and a detailed explanation of the reasoning and the model's thought process.** Focus on the relationship between occupant comfort, room conditions, and energy efficiency. These confidence scores will be used in a Reinforcement Learning (RL) algorithm to inform the optimization of Fan Speed settings.\n\nKey points to consider:\n- Occupant Comfort: Maintain an optimal temperature range of 25-27°C.\n- Energy Efficiency: Ensure the cooling process maintains energy efficiency by preventing excessive Fan Speed adjustments. Focus on finding the balance between optimal temperature and minimal energy use.\n- Temperature & Fan Speed Relationship: A higher Fan Speed results in stronger cooling, reducing room temperature. Fan Speed of 0 means the fan is off.\n\nScenario Settings:\n- Season: Summer (Cooling mode).\n- Effect of FCU Fan Speed:\n  - 0: Fan Off (no cooling).\n  - 1: Low speed (minimal cooling, may be insufficient in high-occupancy rooms.).\n  - 2: Medium speed (moderate cooling).\n  - 3: High speed (maximum cooling, rapid temperature reduction).\n\nBuilding Configuration:\n- 7 rooms in total.\n  - Rooms 1-4: Independent offices. Changes affect only the specific room.\n  - Rooms 5-7 (Large interconnected hall): Changes to one of these rooms affect the others due to air mixing, so any adjustment should consider the collective impact.\n\n\n\nInput Format:\nYou will be provided with real-time status at the current moment (T), and also the status from 5 minutes ago (T-5min).\n\nCurrent Status (at Time T, FCU Fan Speed was active from T-5min to T):\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nStatus 5 minutes ago (at Time T-5min, FCU Fan Speed was active from T-10min to T-5min):\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nOutput Format:\nYou will return a JSON object containing two fields:\n1. "confidence_scores": A list of float values (between 0 and 1). Each float represents the confidence score for a corresponding room (ordered by room_id from 1 to 7) indicating how strongly it should be considered for a Fan Speed adjustment for the next 5-minute interval (T to T+5min). A higher score means a stronger recommendation for adjustment.\n2. "explanation_and_thought_process": A string containing a detailed explanation of the reasoning behind the confidence scores for each room, including all model's thought processes.\n\nOutput Example Types:\n\n1. All rooms are stable and no adjustments are needed:\n{\n  "confidence_scores": [0.05, 0.03, 0.04, 0.06, 0.02, 0.07, 0.05],\n  "explanation_and_thought_process": "All rooms currently show stable temperatures within the optimal range of 25-27°C, with minimal changes in occupant numbers or fan speed effectiveness. Therefore, the confidence scores for adjustment are very low across all rooms, indicating no immediate need for fan speed changes to maintain occupant comfort and energy efficiency. The system aims for minimal intervention when conditions are stable."\n}\n\n2. Some rooms require strong consideration for adjustment:\n{\n  "confidence_scores": [0.1, 0.2, 0.95, 0.15, 0.88, 0.3, 0.08],\n  "explanation_and_thought_process": "Room 3 and Room 5 show high confidence scores due to significant deviations from the optimal temperature range and/or notable changes in occupancy combined with insufficient current fan speeds. For example, Room 3's temperature is rising with new occupants and a low fan speed, while Room 5 is critically hot despite a low fan speed. Other rooms are relatively stable or show minor deviations that do not yet warrant strong adjustment recommendations, considering the balance between comfort and energy efficiency."\n}\n\n\n\nYou will be provided with real-time status at the current moment (T), and also the status from 5 minutes ago (T-5min).\n\nCurrent Status (at Time T, FCU Fan Speed was active from T-5min to T):\nRoom 1 — Temperature: 29.04°C, Occupant Num: 0, Fan Speed: 0;\nRoom 2 — Temperature: 28.37°C, Occupant Num: 0, Fan Speed: 0;\nRoom 3 — Temperature: 28.37°C, Occupant Num: 0, Fan Speed: 0;\nRoom 4 — Temperature: 27.57°C, Occupant Num: 0, Fan Speed: 0;\nRoom 5 — Temperature: 29.98°C, Occupant Num: 0, Fan Speed: 0;\nRoom 6 — Temperature: 27.87°C, Occupant Num: 0, Fan Speed: 0;\nRoom 7 — Temperature: 27.57°C, Occupant Num: 0, Fan Speed: 0;\nOutdoor - Temperature: 36.72°C\n\nStatus 5 minutes ago (at Time T-5min, FCU Fan Speed was active from T-10min to T-5min):\nRoom 1 — Temperature: 28.94°C, Occupant Num: 0, Fan Speed: 0;\nRoom 2 — Temperature: 28.13°C, Occupant Num: 0, Fan Speed: 0;\nRoom 3 — Temperature: 28.13°C, Occupant Num: 0, Fan Speed: 0;\nRoom 4 — Temperature: 27.30°C, Occupant Num: 0, Fan Speed: 0;\nRoom 5 — Temperature: 29.26°C, Occupant Num: 0, Fan Speed: 0;\nRoom 6 — Temperature: 27.50°C, Occupant Num: 0, Fan Speed: 0;\nRoom 7 — Temperature: 27.30°C, Occupant Num: 0, Fan Speed: 0;\nOutdoor - Temperature: 36.39°C'''
        text = '''Role:\nYou are an expert AI assistant for building management systems. Your task is to analyze the current (Time T) and historical (T-1min, T-2min, T-3min, T-4min) real-time status of 7 rooms and determine the likelihood (confidence) that each room's Fan Coil Unit (FCU) Fan Speed setting requires adjustment **for the next 5-minute interval (T to T+5min)**.\n\nGoal:\nAnalyze the **provided current and historical** real-time status of the 7 rooms and output a confidence score for each room regarding the necessity of FCU Fan Speed adjustments **for the next 5-minute interval (T to T+5min)**, based on room temperature and occupancy. **The output should include these confidence scores as a single ordered array and a detailed explanation of the reasoning and the model's thought process.** Focus on the relationship between occupant comfort, room conditions, and energy efficiency. These confidence scores will be used in a Reinforcement Learning (RL) algorithm to inform the optimization of Fan Speed settings.\n\nKey points to consider:\n- Occupant Comfort: Maintain an optimal temperature range of 25-27°C.\n- Energy Efficiency: Ensure the cooling process maintains energy efficiency by preventing excessive Fan Speed adjustments. Focus on finding the balance between optimal temperature and minimal energy use.\n- Temperature & Fan Speed Relationship: A higher Fan Speed results in stronger cooling, reducing room temperature. Fan Speed of 0 means the fan is off.\n\nScenario Settings:\n- Season: Summer (Cooling mode).\n- Effect of FCU Fan Speed:\n  - 0: Fan Off (no cooling).\n  - 1: Low speed (minimal cooling, may be insufficient in high-occupancy rooms.).\n  - 2: Medium speed (moderate cooling).\n  - 3: High speed (maximum cooling, rapid temperature reduction).\n\nBuilding Configuration:\n- 7 rooms in total.\n  - Rooms 1-4: Independent offices. Changes affect only the specific room.\n  - Rooms 5-7 (Large interconnected hall): Changes to one of these rooms affect the others due to air mixing, so any adjustment should consider the collective impact.\n\n\n\nInput Format:\nYou will be provided with real-time status at the current moment (T), and also the status from 1, 2, 3, and 4 minutes ago.\n\nCurrent Status:\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nStatus 1 minute ago:\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nStatus 2 minutes ago:\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nStatus 3 minutes ago:\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\nStatus 4 minutes ago:\nRoom N — Temperature: <value>°C, Occupant Num: <value>, Fan Speed: <value>;\nOutdoor - Temperature: <value>°C\n\n\n\nOutput Format:\nYou will return a JSON object containing two fields:\n1. "confidence_scores": A list of float values (between 0 and 1). Each float represents the confidence score for a corresponding room (ordered by room_id from 1 to 7) indicating how strongly it should be considered for a Fan Speed adjustment for the next 5-minute interval (T to T+5min). A higher score means a stronger recommendation for adjustment.\n2. "explanation_and_thought_process": A string containing a detailed explanation of the reasoning behind the confidence scores for each room, including all model's thought processes.\n\nOutput Example Types:\n\n1. All rooms are stable and no adjustments are needed:\n{\n  "confidence_scores": [0.05, 0.03, 0.04, 0.06, 0.02, 0.07, 0.05],\n  "explanation_and_thought_process": ""\n}\n\n2. Some rooms require strong consideration for adjustment:\n{\n  "confidence_scores": [0.1, 0.2, 0.95, 0.15, 0.88, 0.3, 0.08],\n  "explanation_and_thought_process": ""\n}\n\n\n\nYou will be provided with real-time status at the current moment (T), and also the status from 1, 2, 3, and 4 minutes ago.\n\nCurrent Status (at Time T, FCU Fan Speed was active from T-1min to T):\nRoom 1 — Temperature: 28.96°C, Occupant Num: 1, Fan Speed: 1;\nRoom 2 — Temperature: 28.23°C, Occupant Num: 1, Fan Speed: 1;\nRoom 3 — Temperature: 28.23°C, Occupant Num: 1, Fan Speed: 1;\nRoom 4 — Temperature: 28.91°C, Occupant Num: 5, Fan Speed: 1;\nRoom 5 — Temperature: 32.24°C, Occupant Num: 3, Fan Speed: 1;\nRoom 6 — Temperature: 29.52°C, Occupant Num: 2, Fan Speed: 2;\nRoom 7 — Temperature: 28.91°C, Occupant Num: 5, Fan Speed: 1;\nOutdoor - Temperature: 31.20°C\n\nStatus 1 minute ago (at Time T-1min, FCU Fan Speed was active from T-2min to T-1min):\nRoom 1 — Temperature: 29.05°C, Occupant Num: 1, Fan Speed: 0;\nRoom 2 — Temperature: 28.19°C, Occupant Num: 1, Fan Speed: 1;\nRoom 3 — Temperature: 28.19°C, Occupant Num: 1, Fan Speed: 1;\nRoom 4 — Temperature: 28.95°C, Occupant Num: 4, Fan Speed: 1;\nRoom 5 — Temperature: 32.29°C, Occupant Num: 3, Fan Speed: 1;\nRoom 6 — Temperature: 29.65°C, Occupant Num: 2, Fan Speed: 2;\nRoom 7 — Temperature: 28.95°C, Occupant Num: 4, Fan Speed: 1;\nOutdoor - Temperature: 31.20°C\n\nStatus 2 minutes ago (at Time T-2min, FCU Fan Speed was active from T-3min to T-2min):\nRoom 1 — Temperature: 29.04°C, Occupant Num: 2, Fan Speed: 0;\nRoom 2 — Temperature: 28.12°C, Occupant Num: 1, Fan Speed: 1;\nRoom 3 — Temperature: 28.12°C, Occupant Num: 1, Fan Speed: 1;\nRoom 4 — Temperature: 29.05°C, Occupant Num: 4, Fan Speed: 1;\nRoom 5 — Temperature: 32.29°C, Occupant Num: 3, Fan Speed: 1;\nRoom 6 — Temperature: 29.89°C, Occupant Num: 2, Fan Speed: 2;\nRoom 7 — Temperature: 29.05°C, Occupant Num: 4, Fan Speed: 1;\nOutdoor - Temperature: 31.20°C\n\nStatus 3 minutes ago (at Time T-3min, FCU Fan Speed was active from T-4min to T-3min):\nRoom 1 — Temperature: 29.04°C, Occupant Num: 0, Fan Speed: 0;\nRoom 2 — Temperature: 28.10°C, Occupant Num: 1, Fan Speed: 1;\nRoom 3 — Temperature: 28.10°C, Occupant Num: 1, Fan Speed: 1;\nRoom 4 — Temperature: 29.08°C, Occupant Num: 5, Fan Speed: 1;\nRoom 5 — Temperature: 32.29°C, Occupant Num: 4, Fan Speed: 1;\nRoom 6 — Temperature: 29.93°C, Occupant Num: 2, Fan Speed: 2;\nRoom 7 — Temperature: 29.08°C, Occupant Num: 5, Fan Speed: 1;\nOutdoor - Temperature: 31.20°C\n\nStatus 4 minutes ago (at Time T-4min, FCU Fan Speed was active from T-5min to T-4min):\nRoom 1 — Temperature: 29.04°C, Occupant Num: 0, Fan Speed: 0;\nRoom 2 — Temperature: 28.05°C, Occupant Num: 0, Fan Speed: 0;\nRoom 3 — Temperature: 28.05°C, Occupant Num: 0, Fan Speed: 0;\nRoom 4 — Temperature: 29.19°C, Occupant Num: 4, Fan Speed: 1;\nRoom 5 — Temperature: 32.29°C, Occupant Num: 4, Fan Speed: 0;\nRoom 6 — Temperature: 29.93°C, Occupant Num: 4, Fan Speed: 2;\nRoom 7 — Temperature: 29.19°C, Occupant Num: 4, Fan Speed: 1;\nOutdoor - Temperature: 31.20°C'''
        # text = "Hello, how are you today? This is a test sentence for token counting."

        # 对文本进行编码，获取token ID列表
        tokens = tokenizer.encode(text)

        # 计算token数量
        token_count = len(tokens)

        print(f"\n原始文本: \"{text}\"")
        print(f"编码后的token ID列表: {tokens}")
        print(f"Token数量: {token_count}")

    except Exception as e:
        print(f"An error occurred: {e}")
        print("请确保指定路径下包含正确的tokenizer文件（如tokenizer.json, tokenizer_config.json等），并且文件未损坏。")

